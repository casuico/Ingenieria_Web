{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/mis_publicaciones.css' %}">
{% endblock %}

{% block content %}
<div class="container mis-publicaciones-container">
    <h2 class="titulo-principal">üêæ Mis Publicaciones</h2>

    {% for pub in publicaciones %}
    <div class="publicacion-card">
        <!-- Badge de estado -->
        <div class="estado-badge {% if pub.adoptado %}badge-adoptado{% else %}badge-disponible{% endif %}">
            {% if pub.adoptado %}‚úÖ Adoptado{% else %}üêï Disponible{% endif %}
        </div>

        <!-- Encabezado con t√≠tulo -->
        <div class="publicacion-header">
            <h3 class="publicacion-titulo">{{ pub.titulo }}</h3>
        </div>

        <div class="publicacion-content">
            <div class="row align-items-center">
                <!-- Carrusel de multimedia -->
                {% if pub.multimedia.all %}
                <div class="col-md-5 mb-4 mb-md-0">
                    <div id="carousel{{ forloop.counter }}" class="carousel slide publicacion-carousel" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            {% for media in pub.multimedia.all %}
                            <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                {% if media.tipo == "imagen" %}
                                <img src="{{ media.archivo.url }}" class="d-block w-100" alt="{{ pub.animal.nombre }}">
                                {% elif media.tipo == "video" %}
                                <video controls class="d-block w-100">
                                    <source src="{{ media.archivo.url }}" type="video/mp4">
                                    Tu navegador no soporta videos.
                                </video>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% if pub.multimedia.count > 1 %}
                        <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ forloop.counter }}" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Anterior</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ forloop.counter }}" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Siguiente</span>
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Informaci√≥n del animal -->
                <div class="col-md-7">
                    <div class="animal-info">
                        <div class="info-col">
                            <p><strong>Nombre:</strong> {{ pub.animal.nombre }}</p>
                            <p><strong>Edad:</strong> {{ pub.animal.edad }} a√±os</p>
                            <p><strong>Raza:</strong> {{ pub.animal.raza }}</p>
                        </div>
                        <div class="info-col">
                            <p><strong>Sexo:</strong>
                                {% if pub.animal.sexo == "M" %}Macho{% else %}Hembra{% endif %}
                            </p>
                            <p><strong>Castrado:</strong> {% if pub.animal.castrado %}S√≠{% else %}No{% endif %}</p>
                            <p><strong>Vacunas:</strong>
                                {% if pub.animal.vacunas %}{{ pub.animal.vacunas }}{% else %}No tiene vacunas{% endif %}
                            </p>
                        </div>
                    </div>

                    <!-- Botones de acci√≥n -->
                    <div class="acciones-botones">
                        <a href="{% url 'editar_publicacion' pub.pk %}" class="btn btn-editar">
                            <i class="bi bi-pencil me-2"></i>Editar
                        </a>

                        <form method="POST" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="publicacion_id" value="{{ pub.pk }}">
                            {% if pub.adoptado %}
                            <button type="submit" class="btn btn-no-adoptado">
                                <i class="bi bi-x-circle me-2"></i>No Adoptado
                            </button>
                            {% else %}
                            <button type="submit" class="btn btn-adoptado">
                                <i class="bi bi-check-circle me-2"></i>Adoptado
                            </button>
                            {% endif %}
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <!-- Estado vac√≠o -->
    <div class="estado-vacio">
        <i class="bi bi-inbox"></i>
        <p>No ten√©s publicaciones todav√≠a.</p>
        <a href="{% url 'crear_publicacion' %}" class="btn-crear-publicacion">
            <i class="bi bi-plus-circle me-2"></i>Crear primera publicaci√≥n
        </a>
    </div>
    {% endfor %}
</div>
{% endblock %}